{"remainingRequest":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/src/views/userInfo/index.vue?vue&type=style&index=0&id=7b5e3614&scoped=true&lang=css&","dependencies":[{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/src/views/userInfo/index.vue","mtime":1680946469685},{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/css-loader/dist/cjs.js","mtime":1680943968683},{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1680943969527},{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/postcss-loader/src/index.js","mtime":1680943968838},{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/cache-loader/dist/cjs.js","mtime":1680943968418},{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/vue-loader/lib/index.js","mtime":1680943969372}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouYXZhdGFyLXVwbG9hZGVyIC5lbC11cGxvYWQgewogIGJvcmRlcjogMXB4IGRhc2hlZCAjZDlkOWQ5OwogIGJvcmRlci1yYWRpdXM6IDZweDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgcG9zaXRpb246IHJlbGF0aXZlOwogIG92ZXJmbG93OiBoaWRkZW47Cn0KCi5hdmF0YXItdXBsb2FkZXIgLmVsLXVwbG9hZDpob3ZlciB7CiAgYm9yZGVyLWNvbG9yOiAjNDA5RUZGOwp9CgouYXZhdGFyLXVwbG9hZGVyLWljb24gewogIGZvbnQtc2l6ZTogMjhweDsKICBjb2xvcjogIzhjOTM5ZDsKICB3aWR0aDogMTc4cHg7CiAgaGVpZ2h0OiAxNzhweDsKICBsaW5lLWhlaWdodDogMTc4cHg7CiAgdGV4dC1hbGlnbjogY2VudGVyOwp9CgouYXZhdGFyIHsKICB3aWR0aDogMTc4cHg7CiAgaGVpZ2h0OiAxNzhweDsKICBkaXNwbGF5OiBibG9jazsKfQo="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyRA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/userInfo","sourcesContent":["<template>\n  <div style=\"background-color: white\">\n    <!--  上部简要信息-->\n\n    <v-card style=\"background-color: whitesmoke\">\n      <el-row type=\"flex\" style=\"flex-direction: row\" align=\"middle\">\n        <el-col :offset=\"1\" :span=\"3\" style=\"display: flex;flex-direction: column;justify-content: center\">\n          <el-avatar :size=\"180\" :src=\"avatarUrl\"></el-avatar>\n          <v-btn type=\"primary\" @click=\"showAvatarDialog()\" style=\"margin-top: 1vh\">更换头像</v-btn>\n        </el-col>\n        <el-col :offset=\"2\" :span=\"16\" style=\"display: flex;flex-direction: column;justify-content: space-around\">\n          <v-card-title>用户名</v-card-title>\n          <v-card-subtitle>{{ this.user_info.user_name }}</v-card-subtitle>\n          <v-divider></v-divider>\n          <v-card-title>注册时间</v-card-title>\n          <v-card-subtitle>{{ this.created_time }}</v-card-subtitle>\n          <v-divider></v-divider>\n          <v-card-title>用户角色</v-card-title>\n          <v-card-subtitle>{{ this.user_info.user_role }}</v-card-subtitle>\n        </el-col>\n      </el-row>\n\n    </v-card>\n\n    <el-row :gutter=\"20\" style=\"margin-top: 5vh\" type=\"flex\" justify=\"end\">\n      <el-col :span=\"8\">\n        <el-button type=\"success\" @click=\"showEditDialog()\">编辑</el-button>\n      </el-col>\n    </el-row>\n    <el-row style=\"margin-top: 5vh\" type=\"flex\" justify=\"space-around\">\n      <el-col :span=\"8\">\n        <v-form\n          label-position=\"left\"\n          label-width=\"120px\">\n          <v-text-field label=\"年龄\" v-model=\"temp.user_age\" :counter=\"3\" required>\n          </v-text-field>\n          <v-text-field label=\"性别\" v-model=\"temp.user_gender\" :counter=\"10\" required>\n          </v-text-field>\n          <!--          <v-list-item>-->\n          <!--            <label class=\"v-label v-label&#45;&#45;active theme&#45;&#45;light\"-->\n          <!--                   style=\"left: 1mm; right: auto; position: absolute;font-size: small\">-->\n          <!--              口味</label>-->\n          <!--          </v-list-item>-->\n          <v-select\n            v-model=\"temp.user_favor\"\n            :items=\"favors\"\n            :menu-props=\"{maxHeight: '400'}\"\n            multiple\n            chips\n            hint=\"Pick your favorite favor\"\n            presistent-hint\n            label=\"口味\"\n          >\n            <template v-if=\"true\" v-slot:selection=\"{ item, index }\">\n              <v-chip>\n                <span>{{ item }}</span>\n              </v-chip>\n              <!--              <span-->\n              <!--                v-if=\"index === 1\"-->\n              <!--                class=\"grey&#45;&#45;text caption\"-->\n              <!--              >(+{{ selectModel.length - 1 }} others)</span>-->\n            </template>\n          </v-select>\n        </v-form>\n      </el-col>\n    </el-row>\n    <v-row justify=\"center\">\n      <v-dialog v-model=\"EditDialog\" width=\"250px\">\n        <v-toolbar\n          color=\"green lighten-1\"\n          dark\n        >\n          <v-toolbar-title>确认提交编辑吗？</v-toolbar-title>\n          <v-spacer></v-spacer>\n          <v-btn icon @click=\"EditDialog=false\">\n            <v-icon>mdi-close</v-icon>\n          </v-btn>\n        </v-toolbar>\n        <v-card\n          style=\"display:flex;justify-content: center\"\n        >\n          <v-btn\n            icon\n            @click=\"handleCommit()\"\n          >\n            <v-icon>\n              mdi-check\n            </v-icon>\n          </v-btn>\n        </v-card>\n      </v-dialog>\n    </v-row>\n\n    <v-row>\n      <v-dialog v-model=\"AvatarDialog\" width=\"300px\">\n        <v-toolbar\n          color=\"orange lighten-2\"\n          dark\n        >\n          <v-spacer></v-spacer>\n          <v-toolbar-title>更换头像</v-toolbar-title>\n          <v-spacer></v-spacer>\n          <v-btn icon @click=\"closeUploadAvatar()\">\n            <v-icon>mdi-close</v-icon>\n          </v-btn>\n        </v-toolbar>\n        <v-card style=\"display: flex;justify-content: center\">\n          <!--                    action=\"https://api.superbed.cn/upload?token=8b5da5e83eb94c2aac547844c1f34c29\"-->\n          <el-upload\n            class=\"avatar-uploader\"\n            ref=\"upload\"\n            action=\"https://www.imgtp.com/api/upload\"\n            :headers=\"headerObj\"\n            :show-file-list=\"false\"\n            :on-success=\"handleAvatarSuccess\"\n            :before-upload=\"beforeAvatarUpload\"\n            :with-credentials=\"false\">\n            <img v-if=\"imgUrl\" :src=\"imgUrl\" class=\"avatar\" alt=\"\">\n            <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n          </el-upload>\n        </v-card>\n      </v-dialog>\n    </v-row>\n  </div>\n</template>\n\n<script>\nimport {getProfile, updateInfo, uploadImage} from \"@/api/user\";\nimport {mapGetters} from \"vuex\";\nimport axios from \"axios\";\n\n\nconst favorOptions = [\n  {key: '口味1', display_name: '酸'},\n  {key: '口味2', display_name: '甜'},\n  {key: '口味3', display_name: '辣'},\n]\n\nconst favorKeyValue = favorOptions.reduce((acc, cur) => {\n  acc[cur.key] = cur.display_name\n  return acc\n}, {})\n\nexport default {\n  name: \"index\",\n  data() {\n    return {\n      EditDialog: false,\n      AvatarDialog: false,\n      headerObj: {\n        Authorization: 'a7e9d40943d7d6876ed698cdd25dfb73'\n      },\n      avatarUrl: \"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\",\n      imgUrl: '',\n      selectModel: ['taste1', 'taste2'],\n      favors: ['酸甜', '辣味', '清淡', '苦香'],\n      user_info: {\n        user_id: this.$store.state.user.user_id,\n        user_name: 'Alice',\n        create_time: new Date(),\n        user_role: 'student',\n        user_age: 1,\n        user_gender: 'female',\n        user_favor: [],\n        user_pic: \"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\"\n      },\n      temp: {\n        user_id: this.$store.state.user.user_id,\n        user_name: String,\n        user_age: '',\n        user_gender: '',\n        user_favor: [],\n        user_pic: ''\n      },\n    }\n  },\n  computed: {\n    ...mapGetters([\n      'name',\n      'avatar',\n      'roles',\n      'user_id',\n      'token'\n    ]),\n    created_time() {\n      return new Date(Date.parse(this.user_info.create_time))\n    }\n  },\n  created() {\n    this.handleGetUserInfo()\n  },\n  watch: {\n    multiple(val) {\n      if (val) this.selectModel = [this.selectModel]\n      else this.selectModel = this.selectModel[0]\n    },\n  },\n  methods: {\n    handleGetUserInfo() {\n      let query = {user_id: this.$store.state.user.user_id}\n      getProfile(query).then((res) => {\n        console.log(res)\n        this.user_info = res.data\n        this.user_info.create_time = new Date(+new Date(this.user_info.create_time) + 8 * 3600 * 1000).toISOString().replace(/T/g, ' ').replace(/\\.[\\d]{3}Z/, '')\n        this.temp = this.user_info\n        this.avatarUrl = res.data.user_pic\n        if (this.avatarUrl === null) {\n          this.avatarUrl = \"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\"\n        }\n      })\n    },\n\n    showEditDialog() {\n      this.EditDialog = true\n    },\n    showAvatarDialog() {\n      this.AvatarDialog = true\n    },\n    handleCommit() {\n      let query = this.temp\n      console.log(this.temp)\n      updateInfo(query).then((res) => {\n        console.log(res)\n        this.$nextTick(() => {\n          this.handleGetUserInfo()\n        })\n        this.$notify({\n          title: 'Success',\n          message: '修改成功',\n          type: 'success',\n          duration: 2000\n        })\n      })\n      this.EditDialog = false\n    },\n    handleAvatarSuccess(res, file) {\n      this.submitUpload()\n\n      this.avatarUrl = URL.createObjectURL(file.raw);\n\n      this.imgUrl = this.avatarUrl\n    },\n    submitUpload() {\n      let file = this.$refs.upload.uploadFiles.pop().raw//这里获取上传的文件对象\n      let formData = new FormData()\n      formData.append(\"image\", file)\n      let query = axios.create({\n        headers: {\n          token: 'a7e9d40943d7d6876ed698cdd25dfb73'\n        }\n      })\n      query.post(\"https://www.imgtp.com/api/upload\", formData).then(res => {\n        this.temp.user_pic = res.data.data.url\n        this.handleCommit()\n        console.log(this.temp.user_pic)\n      })\n      setTimeout(() => {\n        this.listLoading = false\n      }, 1.5 * 1000)\n    },\n    beforeAvatarUpload(file) {\n      const isJPG = file.type === 'image/jpeg';\n      const isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG 格式!');\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n      return isJPG && isLt2M;\n    },\n    closeUploadAvatar() {\n      this.AvatarDialog = false\n      this.imgUrl = ''\n    }\n  }\n}\n</script>\n\n<style scoped>\n.avatar-uploader .el-upload {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n\n.avatar-uploader .el-upload:hover {\n  border-color: #409EFF;\n}\n\n.avatar-uploader-icon {\n  font-size: 28px;\n  color: #8c939d;\n  width: 178px;\n  height: 178px;\n  line-height: 178px;\n  text-align: center;\n}\n\n.avatar {\n  width: 178px;\n  height: 178px;\n  display: block;\n}\n</style>\n"]}]}