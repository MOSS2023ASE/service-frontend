{"remainingRequest":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/src/views/management/index.vue?vue&type=style&index=0&id=63621120&lang=css&","dependencies":[{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/src/views/management/index.vue","mtime":1680943788621},{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/css-loader/dist/cjs.js","mtime":1680943968683},{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1680943969527},{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/postcss-loader/src/index.js","mtime":1680943968838},{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/cache-loader/dist/cjs.js","mtime":1680943968418},{"path":"/Users/shl/Desktop/Moss罗杰软工/frontend/buaa2022-db/node_modules/vue-loader/lib/index.js","mtime":1680943969372}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi5lbC1idXR0b24gewogIGNvbG9yOiB3aGl0ZTsKfQoK"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAg0BA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/management","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <div class=\"filter-container\">\n      <el-input\n        v-model=\"listQuery.dish_name\"\n        placeholder=\"输入菜名\"\n        style=\"width: 200px;\"\n        class=\"filter-item\"\n        @keyup.enter.native=\"handleFilter\"\n      />\n      <el-select v-model=\"listQuery.dish_star\" placeholder=\"选择评分\" clearable style=\"width: 90px\" class=\"filter-item\">\n        <el-option v-for=\"item in starOptions\" :key=\"item\" :label=\"item\" :value=\"item\"/>\n      </el-select>\n      <el-select v-model=\"listQuery.canteen_name\" placeholder=\"选择食堂\" clearable class=\"filter-item\"\n                 style=\"width: 130px\">\n        <el-option\n          v-for=\"item in canteenOptions\"\n          :key=\"item.canteen_id\"\n          :label=\"item.canteen_name\"\n          :value=\"item.canteen_name\"\n        />\n      </el-select>\n      <el-select v-model=\"listQuery.sort_by_id\" style=\"width: 140px\" class=\"filter-item\" @change=\"handleFilter\">\n        <el-option v-for=\"item in sortOptions\" :key=\"item.key\" :label=\"item.label\" :value=\"item.key\"/>\n      </el-select>\n      <el-button v-waves class=\"filter-item\" type=\"primary\" icon=\"el-icon-search\" @click=\"handleFilter\"\n                 style=\"margin-left: 3mm\">\n        检索菜品\n      </el-button>\n      <el-button\n        class=\"filter-item\"\n        style=\"margin-left: 10px;\"\n        type=\"primary\"\n        icon=\"el-icon-edit\"\n        @click=\"handleCreate\"\n      >\n        添加菜品\n      </el-button>\n      <el-button\n        class=\"filter-item\"\n        style=\"margin-left: 10px;\"\n        type=\"primary\"\n        icon=\"el-icon-edit\"\n        @click=\"showNotify\"\n      >\n        发布通知\n      </el-button>\n      <el-button\n        class=\"filter-item\"\n        style=\"margin-left: 10px;\"\n        type=\"primary\"\n        icon=\"el-icon-edit\"\n        @click=\"handleCreateCanteen\"\n      >\n        新增食堂\n      </el-button>\n      <el-button\n        class=\"filter-item\"\n        style=\"margin-left: 10px;\"\n        type=\"primary\"\n        icon=\"el-icon-edit\"\n        @click=\"showCanteenList\"\n      >\n        食堂列表\n      </el-button>\n      <!--\n      <el-button\n        v-waves\n        :loading=\"downloadLoading\"\n        class=\"filter-item\"\n        type=\"primary\"\n        icon=\"el-icon-download\"\n        @click=\"handleDownload\"\n      >\n        Export\n      </el-button>\n      -->\n      <!--\n      <el-checkbox v-model=\"showReviewer\" class=\"filter-item\" style=\"margin-left:15px;\" @change=\"tableKey=tableKey+1\">\n        reviewer\n      </el-checkbox>\n      -->\n\n    </div>\n    <el-dialog :visible.sync=\"canteenListVisible\" title=\"食堂列表\" width=\"600px\">\n      <el-table\n        style=\"width: 100%\"\n        :data=\"canteenOptions\"\n        align=\"center\"\n        fit\n        highlight-current-row\n      >\n        <el-table-column\n          prop=\"canteen_name\"\n          label=\"食堂名\"\n          width=\"100%\"\n          align=\"center\"\n        >\n          <template v-slot=\"{row}\">\n            <span>{{ row.canteen_name }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column\n          prop=\"canteen_location\"\n          label=\"食堂地址\"\n          width=\"350px\"\n          align=\"center\"\n        >\n          <template v-slot=\"{row}\">\n            <span>{{ row.canteen_location }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column\n          label=\"操作\"\n          width=\"100%\"\n          align=\"center\"\n        >\n          <template v-slot=\"{row,$index}\">\n            <el-button size=\"mini\" type=\"danger\" @click=\"handleDeleteCanteen(row,$index)\">\n              删除\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-dialog>\n    <div class=\"table-container\">\n      <el-table\n        :key=\"tableKey\"\n        :v-loading=\"listLoading\"\n        :data=\"list\"\n        border\n        fit\n        highlight-current-row\n        style=\"width: 100%;\"\n        @sort-change=\"sortChange\"\n      >\n        <el-table-column\n          label=\"ID\"\n          prop=\"dish_id\"\n          sortable=\"custom\"\n          align=\"center\"\n          width=\"90px\"\n          :class-name=\"getSortClass('dish_id')\"\n        >\n          <template v-slot=\"{row}\">\n            <span>{{ row.dish_id }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"菜品名称\" width=\"200px\" align=\"center\">\n          <template v-slot=\"{row}\">\n            <span>{{ row.dish_name }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"食堂\" width=\"200px\" align=\"center\">\n          <template v-slot=\"{row}\">\n            <span>{{ row.canteen_name }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"价格\" width=\"170px\" align=\"center\">\n          <template v-slot=\"{row}\">\n            <span>￥{{ row.dish_price }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column v-if=\"showReviewer\" label=\"Reviewer\" width=\"110px\" align=\"center\">\n          <template v-slot=\"{row}\">\n            <span style=\"color:red;\">{{ row.reviewer }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"评分\" width=\"180px\" align=\"center\">\n          <template v-slot=\"{row}\">\n            <el-rate\n              v-model=\"row.dish_star\"\n              disabled\n              show-score\n              text-color=\"#ff9900\"\n              score-template=\"{value}\">\n            </el-rate>\n          </template>\n        </el-table-column>\n        <el-table-column label=\"评论数\" align=\"center\" width=\"200px\">\n          <template v-slot=\"{row}\">\n            <span v-if=\"row.comment_count\" class=\"link-type\" @click=\"handleShowComment(row)\"\n            >{{ row.comment_count }}</span>\n            <span v-else>0</span>\n          </template>\n        </el-table-column>\n\n        <el-table-column label=\"操作\" align=\"center\" width=\"385px\" class-name=\"small-padding fixed-width\">\n          <template v-slot=\"{row,$index}\">\n            <el-button type=\"primary\" size=\"mini\" @click=\"handleUpdate(row)\">\n              编辑\n            </el-button>\n            <!--            <el-button-->\n            <!--              v-if=\"row.status!=='published'\"-->\n            <!--              size=\"mini\"-->\n            <!--              type=\"success\"-->\n            <!--              @click=\"handleModifyStatus(row,'published')\"-->\n            <!--            >-->\n            <!--              Publish-->\n            <!--            </el-button>-->\n            <!--            <el-button v-if=\"row.status!=='draft'\" size=\"mini\" @click=\"handleModifyStatus(row,'draft')\">-->\n            <!--              Draft-->\n            <!--            </el-button>-->\n            <el-button v-if=\"row.status!=='deleted'\" size=\"mini\" type=\"danger\" @click=\"handleDelete(row,$index)\">\n              删除\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n    <pagination\n      v-show=\"list_length>0\"\n      :page.sync=\"listQuery.page\"\n      :limit.sync=\"listQuery.limit\"\n      @pagination=\"getList\"\n      :total=\"list_length\"\n    />\n\n    <el-dialog :title=\"textMap[dialogStatus]\" :visible.sync=\"dialogFormVisible\" width=\"600px\">\n      <el-form\n        ref=\"dataForm\"\n        :rules=\"rules\"\n        :model=\"temp\"\n        label-position=\"left\"\n        label-width=\"120px\"\n        style=\"width: 500px; margin-left:30px;\"\n      >\n        <el-form-item label=\"菜品名称\" prop=\"dish_name\">\n          <el-input v-model=\"temp.dish_name\"/>\n        </el-form-item>\n        <el-form-item label=\"食堂\" prop=\"canteen_name\">\n          <el-select v-model=\"temp.canteen_name\" class=\"filter-item\" placeholder=\"Please select\">\n            <el-option\n              v-for=\"item in this.canteenOptions\"\n              :key=\"item.canteen_id\"\n              :label=\"item.canteen_name\"\n              :value=\"item.canteen_name\"\n            />\n          </el-select>\n        </el-form-item>\n        <!--\n        <el-form-item label=\"Date\" prop=\"timestamp\">\n          <el-date-picker v-model=\"temp.timestamp\" type=\"datetime\" placeholder=\"Please pick a date\"/>\n        </el-form-item>\n        -->\n        <el-form-item label=\"价格\" prop=\"dish_price\">\n          <span style=\"font-size: large;padding-right: 5px\">￥</span>\n          <el-input placeholder=\"00.00\" style=\"width: 150px\" v-model=\"temp.dish_price\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"菜品标签\" prop=\"dish_tag\">\n          <el-select v-model=\"temp.dish_tag\" multiple placeholder=\"请选择\">\n            <el-option\n              v-for=\"item in tasteOptions\"\n              :key=\"item.key\"\n              :label=\"item.display_name\"\n              :value=\"item.key\">\n            </el-option>\n          </el-select>\n        </el-form-item>\n\n        <el-form-item label=\"菜品详情\" prop=\"dish_info\">\n          <el-input\n            type=\"textarea\"\n            :rows=\"3\"\n            placeholder=\"请输入内容\"\n            v-model=\"temp.dish_info\">\n          </el-input>\n        </el-form-item>\n\n        <el-form-item label=\"菜品图片\" prop=\"dish_pic\">\n\n          <el-upload\n            class=\"avatar-uploader\"\n            ref=\"upload\"\n            action=\"https://www.imgtp.com/api/upload\"\n            :headers=\"headerObj\"\n            :show-file-list=\"false\"\n            :on-success=\"handleAvatarSuccess\"\n            :before-upload=\"beforeAvatarUpload\"\n            :with-credentials=\"false\">\n            <img v-if=\"imgUrl\" :src=\"imgUrl\" class=\"avatar\" alt=\"\" style=\"max-width: 300px;\">\n            <i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\n          </el-upload>\n        </el-form-item>\n\n\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button type=\"success\" @click=\"dialogFormVisible = false\">\n          取消\n        </el-button>\n        <el-button type=\"primary\" @click=\"dialogStatus==='create'?createData():updateData()\">\n          提交\n        </el-button>\n      </div>\n    </el-dialog>\n\n    <el-dialog :visible.sync=\"dialogCanteenVisible\" title=\"新增食堂\" width=\"450px\"\n               @close=\"canteenDialogStatus='';dialogCanteenVisible=false\">\n      <el-form\n        ref=\"CanteenForm\"\n        :model=\"canteen\"\n        label-position=\"left\"\n        label-width=\"120px\"\n        style=\"width: 300px; margin-left:50px\"\n      >\n        <el-form-item label=\"食堂名\" prop=\"canteen_name\">\n          <el-input v-model=\"canteen.canteen_name\" placeholder=\"请输入内容\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"食堂地址\" prop=\"canteen_location\">\n          <el-input v-model=\"canteen.canteen_location\" placeholder=\"请输入内容\"></el-input>\n        </el-form-item>\n      </el-form>\n      <div slot=\"footer\" class=\"dialog-footer\">\n        <el-button type=\"primary\" @click=\"canteenDialogStatus==='create'?createCanteenData():updateCanteenData()\">\n          Confirm\n        </el-button>\n      </div>\n    </el-dialog>\n    <el-dialog :visible.sync=\"dialogCommentVisible\" title=\"评论列表\" width=\"900px\" @close=\"dialogCommentVisible=false\">\n      <el-table\n        style=\"width: 100%\"\n        :data=\"comments\"\n        align=\"center\"\n        fit\n        highlight-current-row\n      >\n        <el-table-column\n          prop=\"comment_id\"\n          label=\"评论ID\"\n          width=\"100%\"\n          align=\"center\"\n        >\n          <template v-slot=\"{row}\">\n            <span>{{ row.comment_id }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column\n          prop=\"user_name\"\n          label=\"评论用户\"\n          width=\"100%\"\n          align=\"center\"\n        >\n          <template v-slot=\"{row}\">\n            <span>{{ row.headline }}</span>\n          </template>\n        </el-table-column>\n        <el-table-column\n          prop=\"comment_content\"\n          label=\"评论内容\"\n          width=\"300px\"\n          align=\"center\"\n        >\n          <template v-slot=\"{row}\">\n            <span v-html=\"row.subtitle\"></span>\n          </template>\n        </el-table-column>\n        <el-table-column\n          prop=\"comment_star\"\n          label=\"评分\"\n          width=\"200px\"\n          align=\"center\"\n        >\n          <template v-slot=\"{row}\">\n            <el-rate\n              v-model=\"row.comment_star\"\n              disabled\n              show-score\n              text-color=\"#ff9900\"\n              score-template=\"{value}\">\n            </el-rate>\n          </template>\n        </el-table-column>\n        <el-table-column\n          label=\"操作\"\n          width=\"100%\"\n          align=\"center\"\n        >\n          <template v-slot=\"{row,$index}\">\n            <el-button size=\"mini\" type=\"danger\" @click=\"handleDeleteComment(row,$index)\">\n              删除\n            </el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </el-dialog>\n\n    <v-dialog v-model=\"NotifyDialog\" width=\"600px\">\n      <v-card>\n        <v-form v-model=\"valid\">\n          <v-container>\n            <v-row>\n              <v-col>\n                <text-box\n                  @close=\"NotifyDialog = false\"\n                ></text-box>\n              </v-col>\n            </v-row>\n          </v-container>\n        </v-form>\n      </v-card>\n\n    </v-dialog>\n\n\n  </div>\n</template>\n\n<script>\nimport {fetchList, fetchDish, createDish, updateDish, deleteDish} from '@/api/dish'\nimport waves from '@/directive/waves' // waves directive\nimport {parseTime} from '@/utils'\nimport Pagination from '@/components/Pagination'\nimport item from '@/layout/components/Sidebar/Item' // secondary package based on el-pagination\nimport TextBox from \"@/components/Notify/TextBox\";\nimport {createCanteen, deleteCanteen, getCanteenList} from \"@/api/canteen\";\nimport axios from \"axios\";\nimport {updateInfo} from \"@/api/user\";\nimport CommentDialog from \"@/views/management/components/commentDialog\";\nimport {deleteComment, getComments} from \"@/api/comment\";\n// let canteenOptions = [\n//   {key: '合一', display_name: '合一'},\n//   {key: '学二', display_name: '学二'},\n//   {key: '新北', display_name: '新北'}\n// ]\n\nconst tasteOptions = [\n  {key: '酸甜', display_name: '酸甜'},\n  {key: '辣味', display_name: '辣味'},\n  {key: '清淡', display_name: '清淡'},\n  {key: '苦香', display_name: '苦香'}\n]\n\n// arr to obj, such as { CN : \"China\", US : \"USA\" }\n\n// const canteenTypeKeyValue = canteenOptions.reduce((acc, cur) => {\n//   acc[cur.key] = cur.display_name\n//   return acc\n// }, {})\n\nconst MoneyTest = /((^[1-9]\\d*)|^0)(\\.\\d{0,2})?$/\nconst validateMoney = (rule, value, callback) => {\n  rule = MoneyTest\n  if (rule.test(value)) {\n    callback()\n  } else {\n    callback('price must be a number with two decimal places')\n  }\n}\nconst pageList = (list, page, limit) => {\n  // console.log(list.filter((item, index) => index < limit * page && index >= limit * (page - 1)))\n  return list.filter((item, index) => index < limit * page && index >= limit * (page - 1))\n}\nexport default {\n  name: 'ComplexTable',\n  components: {CommentDialog, Pagination, TextBox},\n  directives: {waves},\n  filters: {\n    statusFilter(status) {\n      const statusMap = {\n        published: 'success',\n        draft: 'info',\n        deleted: 'danger'\n      }\n      return statusMap[status]\n    },\n    // canteenFilter(canteen_name) {\n    //   return canteenTypeKeyValue[canteen_name]\n    // },\n\n  },\n  data() {\n    let canteenOptions;\n    return {\n      avatarUrl: \"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png\",\n      AvatarDialog: false,\n      headerObj: {\n        Authorization: 'a7e9d40943d7d6876ed698cdd25dfb73'\n      },\n      imgUrl: '',\n      tableKey: 0,\n      list: null,\n      dish_list: [],\n      list_length: 0,\n      listLoading: true,\n      listQuery: {\n        page: 1,\n        limit: 20,\n        dish_star: undefined,\n        dish_name: undefined,\n        canteen_name: undefined,\n        sort_by_id: '+id'\n      },\n      starOptions: [1, 2, 3, 4, 5],\n      canteenOptions: [],\n      tasteOptions,\n      sortOptions: [{label: 'ID增序', key: '+id'}, {label: 'ID降序', key: '-id'}],\n      showReviewer: false,\n      temp: {\n        dish_id: undefined,\n        dish_name: '',\n        dish_price: Number(0.00),\n        dish_star: 1,\n        canteen_name: '',\n        dish_tag: [],\n        dish_info: '',\n        dish_pic: '',\n        timestamp: new Date(),\n        comment_count: 0\n      },\n      canteen: {\n        canteen_id: 0,\n        canteen_name: '',\n        canteen_location: ''\n      },\n      canteenList: [],\n      canteenDialogStatus: '',\n      canteenListVisible: false,\n      dialogFormVisible: false,\n      dialogCanteenVisible: false,\n      dialogStatus: '',\n      textMap: {\n        update: 'Edit',\n        create: 'Create'\n      },\n      dialogPvVisible: false,\n      dialogCommentVisible: false,\n      rules: {\n        canteen_name: [{required: true, message: 'canteen is required', trigger: 'change'}],\n        timestamp: [{type: 'date', required: true, message: 'timestamp is required', trigger: 'change'}],\n        dish_price: [{\n          validator: validateMoney,\n          message: 'price must be a number with two decimal places',\n          trigger: 'blur'\n        },\n          {required: true, message: 'price is required', trigger: 'blur'}],\n        dish_name: [{required: true, message: 'dish_name is required', trigger: 'blur'}]\n      },\n      downloadLoading: false,\n      NotifyDialog: false,\n      valid: false,\n      comments: []\n    }\n  },\n  created() {\n    this.getList()\n    this.getCanteenList()\n  },\n  methods: {\n    beforeAvatarUpload(file) {\n      const isJPG = file.type === 'image/jpeg';\n      const isLt2M = file.size / 1024 / 1024 < 2;\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG 格式!');\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!');\n      }\n      return isJPG && isLt2M;\n    },\n    handleAvatarSuccess(res, file) {\n      this.submitUpload()\n      this.avatarUrl = URL.createObjectURL(file.raw);\n      this.imgUrl = this.avatarUrl\n    },\n    submitUpload() {\n      let file = this.$refs.upload.uploadFiles.pop().raw//这里获取上传的文件对象\n      let formData = new FormData()\n      formData.append(\"image\", file)\n      let query = axios.create({\n        headers: {\n          token: 'a7e9d40943d7d6876ed698cdd25dfb73'\n        }\n      })\n      query.post(\"https://www.imgtp.com/api/upload\", formData).then(res => {\n        this.temp.dish_pic = res.data.data.url\n        console.log(this.temp.dish_pic)\n      })\n      setTimeout(() => {\n        this.listLoading = false\n      }, 1.5 * 1000)\n    },\n    showAvatarDialog() {\n      this.AvatarDialog = true\n    },\n    getList() {\n      this.listLoading = true\n      fetchList(this.listQuery).then(response => {\n        this.list_length = Number(response.data.list_length)\n        this.list = pageList(response.data.dish_list, this.listQuery.page, this.listQuery.limit)\n\n        console.log(typeof (this.list_length))\n        // Just to simulate the time of the request\n        setTimeout(() => {\n          this.listLoading = false\n        }, 1.5 * 1000)\n      })\n    },\n    getCanteenList() {\n      this.listLoading = true\n      getCanteenList().then((res) => {\n        this.canteenOptions = res.data.canteen_list\n      })\n    },\n    showCanteenList() {\n      this.canteenListVisible = true\n    },\n    showNotify() {\n      this.NotifyDialog = true\n    },\n    handleFilter() {\n      this.listQuery.page = 1\n      this.getList()\n    },\n    handleModifyStatus(row, status) {\n      this.$message({\n        message: '操作Success',\n        type: 'success'\n      })\n      row.status = status\n    },\n    sortChange(data) {\n      const {prop, order} = data\n      if (prop === 'dish_id') {\n        this.sortByID(order)\n      }\n    },\n    sortByID(order) {\n      if (order === 'ascending') {\n        this.listQuery.sort_by_id = '+id'\n      } else {\n        this.listQuery.sort_by_id = '-id'\n      }\n      this.handleFilter()\n    },\n    resetTemp() {\n      this.temp = {\n        dish_id: undefined,\n        dish_name: '',\n        dish_price: 0,\n        dish_star: 1,\n        timestamp: new Date(),\n        canteen_name: ''\n      }\n\n    },\n    handleCreateCanteen() {\n      this.dialogCanteenVisible = true\n      this.canteenDialogStatus = 'create'\n    },\n    handleDeleteCanteen(row, index) {\n      this.canteen = Object.assign({}, row)\n      let Did = {\n        canteen_id: this.canteen.canteen_id\n      }\n      deleteCanteen(Did).then(() => {\n          this.list.splice(index, 1)\n          this.getCanteenList()\n        }\n      )\n      this.$notify({\n        title: 'Success',\n        message: '删除成功',\n        type: 'success',\n        duration: 2000\n      })\n    },\n    createCanteenData() {\n      let query = this.canteen\n      createCanteen(query).then((res) => {\n        this.getCanteenList()\n      })\n      this.$notify({\n        title: 'Success',\n        message: '添加成功',\n        type: 'success',\n        duration: 2000\n      })\n      this.dialogCanteenVisible = false\n    },\n    handleCreate() {\n      this.resetTemp()\n      this.dialogStatus = 'create'\n      this.dialogFormVisible = true\n      this.imgUrl = ''\n      this.$nextTick(() => {\n        this.$refs['dataForm'].clearValidate()\n      })\n    },\n    createData() {\n      this.$refs['dataForm'].validate((valid) => {\n        if (valid) {\n          // this.temp.dish_id = parseInt(Math.random() * 100) + 1024 // mock a id\n          createDish(this.temp).then(() => {\n            this.list.unshift(this.temp)\n            this.dialogFormVisible = false\n            this.$notify({\n              title: 'Success',\n              message: '创建成功',\n              type: 'success',\n              duration: 2000\n            })\n          })\n        }\n      })\n    },\n    handleUpdate(row) {\n      this.temp = Object.assign({}, row) // copy obj\n      this.imgUrl = this.temp.dish_pic\n      this.temp.timestamp = new Date(this.temp.timestamp)\n      this.dialogStatus = 'update'\n      this.dialogFormVisible = true\n      this.$nextTick(() => {\n        this.$refs['dataForm'].clearValidate()\n      })\n    },\n    updateData() {\n      this.$refs['dataForm'].validate((valid) => {\n        if (valid) {\n          const tempData = Object.assign({}, this.temp)\n          tempData.timestamp = +new Date(tempData.timestamp) // change Thu Nov 30 2017 16:41:05 GMT+0800 (CST) to 1512031311464\n          updateDish(tempData).then(() => {\n            const index = this.list.findIndex(v => v.dish_id === this.temp.dish_id)\n            this.list.splice(index, 1, this.temp)\n            this.dialogFormVisible = false\n            this.$notify({\n              title: 'Success',\n              message: '更新成功',\n              type: 'success',\n              duration: 2000\n            })\n          })\n        }\n      })\n    },\n    handleDelete(row, index) {\n      this.temp = Object.assign({}, row)\n      let Did = {\n        dish_id: this.temp.dish_id\n      }\n      deleteDish(Did).then(() => {\n          this.list.splice(index, 1)\n        }\n      )\n      this.$notify({\n        title: 'Success',\n        message: '删除成功',\n        type: 'success',\n        duration: 2000\n      })\n    },\n    handleUpdateComment(row) {\n      this.commentDialogStatus = true\n    },\n    handleDownload() {\n      this.downloadLoading = true\n      import('@/vendor/Export2Excel').then(excel => {\n        const tHeader = ['timestamp', 'dish_name', 'canteen_name', 'dish_star', 'status']\n        const filterVal = ['timestamp', 'dish_name', 'canteen_name', 'dish_star', 'status']\n        const data = this.formatJson(filterVal)\n        excel.export_json_to_excel({\n          header: tHeader,\n          data,\n          filename: 'table-list'\n        })\n        this.downloadLoading = false\n      })\n    },\n    formatJson(filterVal) {\n      return this.list.map(v => filterVal.map(j => {\n        if (j === 'timestamp') {\n          return parseTime(v[j], '')\n        } else {\n          return v[j]\n        }\n      }))\n    },\n    getSortClass: function (key) {\n      const sort = this.listQuery.sort_by_id\n      return sort === `+${key}` ? 'ascending' : 'descending'\n    },\n    handleShowComment(row) {\n      this.dialogCommentVisible = true\n      this.handleGetComments(row)\n    },\n    handleGetComments(row) {\n      let list_query = {user_id: this.user_id, dish_id: row.dish_id}\n      getComments(list_query).then((response) => {\n        let originData = response.data.comment_list\n        console.log(originData)\n        let o = {}\n        this.$nextTick(() => {\n          this.comments = []\n          for (o in originData) {\n            let comment = {\n              comment_id: originData[o].comment_id,\n              user_id: originData[o].user_id,\n              action: '',\n              headline: originData[o].user_name,\n              title: '评论',\n              subtitle: originData[o].comment_text,\n              comment_star: originData[o].comment_star\n            }\n            this.comments.push(comment)\n          }\n        })\n      })\n    },\n    handleDeleteComment(row, index) {\n      let query = {\n        comment_id: row.comment_id\n      }\n      deleteComment(query).then(() => {\n        this.comments.splice(index, 1)\n        this.$nextTick(() => {\n          this.handleGetComments()\n        })\n        this.$notify({\n          title: 'Success',\n          message: '删除成功',\n          type: 'success',\n          duration: 2000\n        })\n        this.getList()\n      })\n    },\n  }\n}\n</script>\n<style>\n.el-button {\n  color: white;\n}\n\n</style>\n"]}]}